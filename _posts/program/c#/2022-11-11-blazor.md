---
layout:		post
category:	"program"
title:		"C#Web开发之blazor"

tags:		[c#]
---
- Content
{:toc}


参考：[File Upload with Blazor WebAssembly and ASP.NET Core Web API](https://code-maze.com/blazor-webassembly-file-upload/)，GitHub地址：[CodeMazeBlog/blazor-series at blazor-file-upload](https://github.com/CodeMazeBlog/blazor-series/tree/blazor-file-upload)

工程里面有两个项目，分别是server（服务端）和client（客户端）。



# 搭建步骤

## 1、数据库配置

- 查看server项目目录，有一个`Migrations`文件夹，这个是自动导出的快照文件，可以直接用这个再重新生成数据库的表文件及内容；这里稍作一些修改。

- 查看`appsettings.json`文件，数据库名称修改为：`appdb`，`sqlConnection`的内容修改如下：

  ```json
  "ConnectionStrings": {
      "sqlConnection": "server=(localdb)\\MSSQLLocalDB; database=appdb; Integrated Security=true"
  },
  ```

- 在server项目中，打开`SQL Server对象资源管理器`（VisualStudio菜单：视图 - SQL Server对象资源管理器）；打开后默认会有一个`(localdb)\MSSQLLocalDB`，里面有一些系统数据库，在`数据库`这个目录上右键选择`添加新数据库`；数据库名称填：`appdb`，数据库位置重新选择一个，例如：`E:\sql`

- `Migrations`目录下的文件，逐个修改下，按照需要的表格的字段修改，模拟添加的数据也修改好，最后在`PM程序包管理器控制台`里面执行命令`update-database`，即可自动生成表格并自动导入测试数据，如果有个别错误可以根据日志进行修正。



## 2、支持局域网访问

https的配置比较麻烦，而且第一次玩这个，不想太花时间折腾，本着先跑通的想法，先简单弄起来。

- server项目里面`Startup.cs`文件`Configure`函数注释掉这两句调用：

  ```csharp
  app.UseHttpsRedirection();
  app.UseAuthorization();
  ```

- server项目`launchSettings.json`去掉对https的支持，修改为：

  ```json
  {
    "iisSettings": {
      "windowsAuthentication": false,
      "anonymousAuthentication": true,
      "iisExpress": {
        "applicationUrl": "http://localhost:52497",
        "sslPort": 0
      }
    },
    "profiles": {
      "BlazorProducts.Server": {
        "commandName": "Project",
        "launchBrowser": false,
        "applicationUrl": "http://localhost:5010;http://*:5010",
        "environmentVariables": {
          "ASPNETCORE_ENVIRONMENT": "Development"
        }
      }
    }
  }
  ```

- client项目的`launchSettings.json`去掉对https的支持，修改为：

```json
{
  "profiles": {
    "BlazorProducts.Client": {
      "commandName": "Project",
      "dotnetRunMessages": "true",
      "launchBrowser": true,
      "inspectUri": "{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}",
      "applicationUrl": "http://localhost:5000;http://*:5000;",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
```

- client项目代码里面凡是涉及到API接口调用的地方，一律修改为 `http://作为服务器的电脑的具体IP地址:5010`
- 



# 参考

- [学习ASP.NET Core Blazor编程系列四——迁移 - DotNet菜园](https://www.cnblogs.com/chillsrc/p/16747434.html)
- [net::ERR_CERT_AUTHORITY_INVALID 在 ASP.NET Core 中 |](https://qa.1r1g.com/sf/ask/4465759651/)
- [ASP.NET内核中的net::ERR_CERT_AUTHORITY_INVALID - 问答 - 腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/ask/sof/1109771)
- 
